{% extends 'shop/basic.html' %}
{% block title %}Product View Page{% endblock %}
{% block body %}
<div class="container my-4">
    <div class="row">
        <div class="col-md-4">
            <img class="img-fluid rounded" src="{{product.image.url}}" alt="{{product.product_name}}">
        </div>
        <div class="col-md-8">
            <h2>{{product.product_name}}</h2>
            <p class="text-muted">{{product.description}}</p>
            <p><strong>â‚¹{{product.price}}</strong></p>
            <p>Available Quantity: 223</p>

        <div class="mt-3">
            <button class="btn btn-success me-2">Buy Now</button>
            <button class="btn btn-primary">Add to Cart</button>
        </div>
            </div>
    </div>
</div>
{% block js %}
<script>
// ---------- 1. INITIAL CART SETUP ----------
  let cart = JSON.parse(localStorage.getItem('cart')) || {};


  // ---------- 2. UPDATE CART COUNT ----------
  function updateCartCount() {
    const totalItems = Object.values(cart).reduce((sum, item) => sum + item.quantity, 0);
    document.getElementById('cart-count').textContent = totalItems;
  }

  // ---------- 3. UPDATE CART POPOVER ----------
  function updateCartPopover() {
    const container = document.getElementById('cart-items');
    let content = '<ol class="list-group list-group-flush numbered-list">';

    for (const [id, product] of Object.entries(cart)) {
      content += `<li class="list-group-item">${product.name} : ${product.quantity}</li>`;
    }

   content += `
    </ol>
    <div class="d-flex justify-content-center gap-2">
        <a href="{% url 'shop_checkout' %}" class="btn btn-sm btn-primary">Checkout</a>
        <button class="btn btn-sm btn-danger clear-cart">Clear Cart</button>
    </div>
`;

    let popoverInstance = bootstrap.Popover.getInstance(container);

    if (popoverInstance) {
      popoverInstance.setContent({ '.popover-body': content });
    } else {
      new bootstrap.Popover(container, {
        html: true,
        allowHtml: true,
        sanitize: false,
        content: content,
        title: 'Cart Items'
      });
    }
  }


  // ---------- 4. EVENT HANDLERS ----------
  document.addEventListener('click', (e) => {
      if (e.target.classList.contains('clear-cart')) {
        cart = {};
        localStorage.setItem('cart', JSON.stringify(cart));
          updateCartCount();
        updateCartPopover();
    }
  });

  // ---------- 5. INITIAL PAGE LOAD ----------
  document.addEventListener('DOMContentLoaded', () => {
    updateCartCount();
    updateCartPopover();
  });
</script>
    {% endblock %}
{% endblock %}